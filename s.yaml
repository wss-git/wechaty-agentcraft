edition: 3.0.0
name: agentcraft-clientaccess-wechat
access: default
vars:
  region: 'cn-hangzhou'
  fe_function: 'agentcraft-wechat-yunche-fe'
  be_function: 'agentcraft-wechat-yunche-server'
  token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjM2LCJleHAiOjE3NDI3MDMzMzN9.qlaRSdQjdfiK3YYoz4d5in_SU8UZfb1MlQ_mODa6Y3k'
  baseUrl: 'http://agentcraft-backend-latest.fcv3.1075835892027251.cn-hangzhou.fc.devsapp.net'
  agentType: 'knowledgeBase'
template:
  AgentCraftAll:
    internetAccess: true
    vpcConfig: auto
resources:
  agentcraft-wechat-agent-server:
    component: fc3
    props:
      region: ${vars.region}
      description: AgentCraft构建的用来提供微信代理后端的服务
      timeout: 600
      diskSize: 512
      customRuntimeConfig:
        port: 8080
        command:
          - bootstrap
      layers:
        - acs:fc:${vars.region}:official:layers/Nodejs18/versions/1
        - acs:fc:${vars.region}:1611387345152601:layers/ac-clientaccess-wechat/versions/4
      runtime: custom.debian10
      instanceConcurrency: 200
      memorySize: 3072
      role: AliyunFCDefaultRole
      cpu: 2
      environmentVariables:
        baseUrl: ${vars.baseUrl}
        agentType: ${vars.agentType}
        token: ${vars.token}
        LD_LIBRARY_PATH: /opt/nodejs/node_modules/puppeteer/.local-chromium/linux-982053/chrome-linux:/opt/lib/x86_64-linux-gnu:/opt/lib
        NODE_PATH: /opt/nodejs/node_modules
        Region: ${vars.region}
        autoReply: 'true'
        PATH: >-
          /opt/nodejs18/bin::/usr/local/bin/apache-maven/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/ruby/bin:/opt/bin:/code:/code/bin:/opt/nodejs/node_modules/.bin
      functionName: ${vars.be_function}
      code: ./ac-wechat-all/ac-wechat-server
      triggers:
        - description: ''
          qualifier: LATEST
          triggerName: defaultTrigger
          triggerType: http
          triggerConfig:
            methods:
              - GET
              - POST
              - PUT
              - DELETE
            authType: anonymous
            disableURLInternet: false
    extend:
      name: AgentCraftAll
  agentcraft-wechat-fe:
    component: fc3
    props:
      region: ${vars.region}
      description: AgentCraft构建的用来管理微信信息的前端服务
      timeout: 600
      diskSize: 512
      customRuntimeConfig:
        port: 3000
        command:
          - bootstrap
      layers:
        - acs:fc:${vars.region}:official:layers/Nodejs18/versions/1
        - acs:fc:${vars.region}:1611387345152601:layers/ac-clientaccess-wechat-fe/versions/1
      runtime: custom.debian10
      instanceConcurrency: 200
      memorySize: 3072
      role: AliyunFCDefaultRole
      cpu: 2
      environmentVariables:
        beServiceDomain: ${resources.agentcraft-wechat-agent-server-domain.output.domainName}
        beFunctionName: ${vars.be_function}
        NODE_PATH: /opt/nodejs/node_modules
        Region: ${vars.region}
        PATH: >-
          /opt/nodejs18/bin::/usr/local/bin/apache-maven/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/ruby/bin:/opt/bin:/code:/code/bin:/opt/nodejs/node_modules/.bin
      functionName: ${vars.fe_function}
      code: ./ac-wechat-all/ac-wechat-fe
      triggers:
        - description: ''
          qualifier: LATEST
          triggerName: defaultTrigger
          triggerType: http
          triggerConfig:
            methods:
              - GET
              - POST
              - PUT
              - DELETE
            authType: anonymous
            disableURLInternet: false
    extend:
      name: AgentCraftAll
  agentcraft-wechat-fe-domain:
    component: fc3-domain@0.0.7
    props:
      region: ${vars.region}
      domainName: auto
      protocol: HTTP
      routeConfig:
        routes:
          - path: /*
            functionName: ${vars.fe_function}